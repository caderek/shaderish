(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))r(t);new MutationObserver(t=>{for(const n of t)if(n.type==="childList")for(const d of n.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&r(d)}).observe(document,{childList:!0,subtree:!0});function a(t){const n={};return t.integrity&&(n.integrity=t.integrity),t.referrerPolicy&&(n.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?n.credentials="include":t.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(t){if(t.ep)return;t.ep=!0;const n=a(t);fetch(t.href,n)}})();function L(e,o=1){return e/o*2-1}function q(e,o,a,r,t){const{w:n,h:d}=a;for(let i=r;i<t;i+=4){const w=i/4,j=w%n,C=Math.trunc(w/n),U=Math.fround((j+.5)/(n/2)-1),$=Math.fround(1-(C+.5)/(d/2)),h=o(U,$,a);e[i]=h[0]*255,e[i+1]=h[1]*255,e[i+2]=h[2]*255,e[i+3]=h[3]*255}}const B=1/0,N=640*2/devicePixelRatio,O=e=>e/1,c=O(640),l=O(360),X=N/c,T=await Promise.all(["plasma","singularity","accretion","rainbow","warp"].map(D)),M=T[0],p=document.querySelector("canvas",{alpha:!1,willReadFrequently:!1});p.width=c;p.height=l;p.style.setProperty("--width",c);p.style.setProperty("--scale",X);const Y=document.getElementById("fps"),z=p.getContext("2d");async function D(e){const o=await fetch(`/shaders/${e}.js`).then(r=>r.blob()),a=new File([o],"shader.js",{type:"application/javascript"});return URL.createObjectURL(a)}const m=c*l*4,v=crossOriginIsolated?new SharedArrayBuffer(m):new ArrayBuffer(m),f=new Uint8ClampedArray(v),I=crossOriginIsolated?new Uint8ClampedArray(m):f,K=new ImageData(I,c,l);let g=0,S=0,P=0,x=0;window.addEventListener("mousemove",e=>{P=L(e.clientX,1920),x=L(e.clientY,1080)});const W=navigator.hardwareConcurrency??4,s=Math.min(crossOriginIsolated?W-1:0,B),_=Math.ceil(f.byteLength/128),u=Math.ceil(_/(s+1))*128;console.log({crossOriginIsolated});console.log({threads:s+1});console.log({bufferSize:m,chunkSize:u});const R=Array.from({length:s},()=>new Worker(new URL("/assets/run-BfqAslBo.js",import.meta.url),{type:"module"}));let y=0,b=0,A=null,E=null,Z=new Promise(e=>{E=e});const k=(await import(M)).fragment;R.forEach(e=>{e.addEventListener("message",o=>{switch(o.data){case"rendered":{y++,y===s&&A();break}case"loaded":{b++,b===s&&E();break}}}),e.postMessage(["init",v]),e.postMessage(["loadShader",M])});async function F(e=0){s>0&&await Z;const o=performance.now();let a;if(s>0&&(a=new Promise(r=>{A=r}),R.forEach((r,t)=>r.postMessage(["runShader",{t:e/1e3,w:c,h:l},[[t*u,t*u+u]]]))),q(f,k,{t:e/1e3,w:c,h:l,mouseX:P,mouseY:x},u*s,f.byteLength),s>0&&(await a,y=0),g%10===0){const r=performance.now()-o,t=e-S,n=t>0?1e3/t:0;Y.innerText=`FPS: ${n.toFixed(1)}, Render: ${r.toFixed(2)}ms, Threads: ${s+1}, Res: ${c}x${l}px`,g=0}S=e,g++,I.set(f),z.putImageData(K,0,0),requestAnimationFrame(F)}F();
