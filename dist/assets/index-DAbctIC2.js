(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))s(t);new MutationObserver(t=>{for(const o of t)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function r(t){const o={};return t.integrity&&(o.integrity=t.integrity),t.referrerPolicy&&(o.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?o.credentials="include":t.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(t){if(t.ep)return;t.ep=!0;const o=r(t);fetch(t.href,o)}})();function F(e,n=1){return e/n*2-1}const h=8;function G(e,n,r,s,t){const{w:o,h:a}=r,y=Math.ceil(o/h);for(let f=s;f<t;f++){const g=f%y*h,x=Math.trunc(f/y)*h;for(let d=x;d<x+h&&d<a;d++){const w=d*o;for(let m=g;m<g+h&&m<o;m++){const S=(w+m)*4,K=Math.fround((m+.5)/(o/2)-1),k=Math.fround(1-(d+.5)/(a/2)),b=n(K,k,r);e[S]=b[0]*255,e[S+1]=b[1]*255,e[S+2]=b[2]*255,e[S+3]=b[3]*255}}}}const I=8,H=4;function J(e,n,r,s){const t=I*H;for(let o=0;o<e.length/t;o++){const a=Math.floor(o/I),y=a%r,f=Math.floor(a/r),g=o%I,d=(f*I+g)*r+y,w=o*t;n.set(e.subarray(w,w+t),d*t)}}document.querySelector("footer").textContent="v0.0.1";const Q=1/0,P=8,j=e=>e/1,V=640*2/devicePixelRatio,c=j(640),i=j(360),ee=V/c,te=await Promise.all(["circle","plasma","singularity","rainbow","warp","accretion","phospor"].map(re)),z=te[4],u=document.querySelector("canvas",{alpha:!1,willReadFrequently:!1});u.width=c;u.height=i;u.style.setProperty("--width",c);u.style.setProperty("--scale",ee);u.style.setProperty("--ratio",`${c} / ${i}`);const oe=document.getElementById("fps"),ne=u.getContext("2d");async function re(e){const n=await fetch(`/shaders/${e}.js`).then(s=>s.blob()),r=new File([n],"shader.js",{type:"application/javascript"});return URL.createObjectURL(r)}const se=c*i*4,T=P**2*4,M=Math.ceil(c/P),Y=Math.ceil(i/P),v=M*Y,p=T*v,E=64,C=p+E,O=crossOriginIsolated?new SharedArrayBuffer(C):new ArrayBuffer(C),$=new Uint8ClampedArray(O,0,p),ce=new Uint32Array(O,p,E/4),_=crossOriginIsolated?new Uint8ClampedArray(p):$,ae=new ImageData(_.subarray(0,se),c,i);let R=0,U=0,q=0,B=0;window.addEventListener("mousemove",e=>{q=F(e.clientX,1920),B=F(e.clientY,1080)});const ie=navigator.hardwareConcurrency??4,l=Math.min(crossOriginIsolated?ie:0,Q),L=Math.ceil(v/l);console.log({crossOriginIsolated});console.log({threads:l>0?l:1});console.table({w:c,h:i,tileSize:P,tilesPerRow:M,tilesPerCol:Y,tilesCount:v,tileByteSize:T,tilesPerWorker:L,framebufferSize:p,controlbufferSize:E,vramSize:C});console.log(O);const N=Array.from({length:l},()=>new Worker(new URL("/assets/run-CL-bfvoL.js",import.meta.url),{type:"module"}));let A=0,X=0,W=null,Z=null,le=new Promise(e=>{Z=e});const de=(await import(z)).fragment;N.forEach(e=>{e.addEventListener("message",n=>{switch(n.data){case"rendered":{A++,A===l&&W();break}case"loaded":{X++,X===l&&Z();break}}}),e.postMessage(["init",O,p,E,M,Y]),e.postMessage(["loadShader",z])});async function D(e=0){l>0&&await le;const n=performance.now();let r;if(l>0?(r=new Promise(s=>{W=s}),N.forEach((s,t)=>s.postMessage(["runShader",{t:e/1e3,w:c,h:i},[[t*L,t*L+L]]])),await r,A=0,ce[0]=0):G($,de,{t:e/1e3,w:c,h:i,mouseX:q,mouseY:B},0,v),R%10===0){const s=performance.now()-n,t=e-U,o=t>0?1e3/t:0;oe.innerText=`FPS: ${o.toFixed(1)}, Render: ${s.toFixed(2)}ms, Threads: ${l??1}, Res: ${c}x${i}px`,R=0}U=e,R++,J($,_,M),ne.putImageData(ae,0,0),requestAnimationFrame(D)}D();
