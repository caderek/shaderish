(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))r(t);new MutationObserver(t=>{for(const o of t)if(o.type==="childList")for(const d of o.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&r(d)}).observe(document,{childList:!0,subtree:!0});function a(t){const o={};return t.integrity&&(o.integrity=t.integrity),t.referrerPolicy&&(o.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?o.credentials="include":t.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(t){if(t.ep)return;t.ep=!0;const o=a(t);fetch(t.href,o)}})();function L(e,n=1){return e/n*2-1}function U(e,n,a,r,t){const{w:o,h:d}=a;for(let i=r;i<t;i+=4){const w=i/4,F=w%o,$=Math.trunc(w/o),j=Math.fround((F+.5)/(o/2)-1),q=Math.fround(1-($+.5)/(d/2)),h=n(j,q,a);e[i]=h[0]*255,e[i+1]=h[1]*255,e[i+2]=h[2]*255,e[i+3]=h[3]*255}}document.querySelector("footer").textContent="v0.0.1";const B=1/0,N=640*2/devicePixelRatio,O=e=>e/1,c=O(640),l=O(360),X=N/c,T=await Promise.all(["plasma","singularity","accretion","rainbow","warp"].map(D)),v=T[0],p=document.querySelector("canvas",{alpha:!1,willReadFrequently:!1});p.width=c;p.height=l;p.style.setProperty("--width",c);p.style.setProperty("--scale",X);const Y=document.getElementById("fps"),z=p.getContext("2d");async function D(e){const n=await fetch(`/shaders/${e}.js`).then(r=>r.blob()),a=new File([n],"shader.js",{type:"application/javascript"});return URL.createObjectURL(a)}const m=c*l*4,M=crossOriginIsolated?new SharedArrayBuffer(m):new ArrayBuffer(m),f=new Uint8ClampedArray(M),x=crossOriginIsolated?new Uint8ClampedArray(m):f,K=new ImageData(x,c,l);let y=0,S=0,I=0,P=0;window.addEventListener("mousemove",e=>{I=L(e.clientX,1920),P=L(e.clientY,1080)});const W=navigator.hardwareConcurrency??4,s=Math.min(crossOriginIsolated?W-1:0,B),_=Math.ceil(f.byteLength/128),u=Math.ceil(_/(s+1))*128;console.log({crossOriginIsolated});console.log({threads:s+1});console.log({bufferSize:m,chunkSize:u});const R=Array.from({length:s},()=>new Worker(new URL("/assets/run-BfqAslBo.js",import.meta.url),{type:"module"}));let g=0,b=0,A=null,E=null,Z=new Promise(e=>{E=e});const k=(await import(v)).fragment;R.forEach(e=>{e.addEventListener("message",n=>{switch(n.data){case"rendered":{g++,g===s&&A();break}case"loaded":{b++,b===s&&E();break}}}),e.postMessage(["init",M]),e.postMessage(["loadShader",v])});async function C(e=0){s>0&&await Z;const n=performance.now();let a;if(s>0&&(a=new Promise(r=>{A=r}),R.forEach((r,t)=>r.postMessage(["runShader",{t:e/1e3,w:c,h:l},[[t*u,t*u+u]]]))),U(f,k,{t:e/1e3,w:c,h:l,mouseX:I,mouseY:P},u*s,f.byteLength),s>0&&(await a,g=0),y%10===0){const r=performance.now()-n,t=e-S,o=t>0?1e3/t:0;Y.innerText=`FPS: ${o.toFixed(1)}, Render: ${r.toFixed(2)}ms, Threads: ${s+1}, Res: ${c}x${l}px`,y=0}S=e,y++,x.set(f),z.putImageData(K,0,0),requestAnimationFrame(C)}C();
