(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))o(e);new MutationObserver(e=>{for(const n of e)if(n.type==="childList")for(const l of n.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&o(l)}).observe(document,{childList:!0,subtree:!0});function a(e){const n={};return e.integrity&&(n.integrity=e.integrity),e.referrerPolicy&&(n.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?n.credentials="include":e.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function o(e){if(e.ep)return;e.ep=!0;const n=a(e);fetch(e.href,n)}})();function w(t,r=1){return t/r*2-1}function $(t,r,a,o,e){const{w:n,h:l}=a;for(let p=o;p<e;p+=4){const y=p/4,C=y%n,F=Math.trunc(y/n),j=(C+.5)/(n/2)-1,U=1-(F+.5)/(l/2);t.set(r(j,U,a),p)}}const q=1/0,N=640*2/devicePixelRatio,S=t=>t/2,c=S(640),i=S(360),X=N/c,B=await Promise.all(["plasma","singularity","accretion","rainbow","warp"].map(z)),O=B[0],u=document.querySelector("canvas",{alpha:!1,willReadFrequently:!1});u.width=c;u.height=i;u.style.setProperty("--width",c);u.style.setProperty("--scale",X);const T=document.getElementById("fps"),Y=u.getContext("2d");async function z(t){const r=await fetch(`/shaders/${t}.js`).then(o=>o.blob()),a=new File([r],"shader.js",{type:"application/javascript"});return URL.createObjectURL(a)}const m=c*i*4,v=crossOriginIsolated?new SharedArrayBuffer(m):new ArrayBuffer(m),f=new Uint8ClampedArray(v),I=crossOriginIsolated?new Uint8ClampedArray(m):f,D=new ImageData(I,c,i);let h=0,b=0,P=0,R=0;window.addEventListener("mousemove",t=>{P=w(t.clientX,1920),R=w(t.clientY,1080)});const K=navigator.hardwareConcurrency??4,s=Math.min(crossOriginIsolated?K-1:0,q),W=Math.ceil(f.byteLength/128),d=Math.ceil(W/(s+1))*128;console.log({crossOriginIsolated});console.log({threads:s+1});console.log({bufferSize:m,chunkSize:d});const x=Array.from({length:s},()=>new Worker(new URL("/assets/run-ACRknii5.js",import.meta.url),{type:"module"}));let g=0,L=0,M=null,A=null,_=new Promise(t=>{A=t});const k=(await import(O)).fragment;x.forEach(t=>{t.addEventListener("message",r=>{switch(r.data){case"rendered":{g++,g===s&&M();break}case"loaded":{L++,L===s&&A();break}}}),t.postMessage(["init",v]),t.postMessage(["loadShader",O])});async function E(t=0){s>0&&await _;const r=performance.now();let a;if(s>0&&(a=new Promise(o=>{M=o}),x.forEach((o,e)=>o.postMessage(["runShader",{t:t/1e3,w:c,h:i},[[e*d,e*d+d]]]))),$(f,k,{t:t/1e3,w:c,h:i,mouseX:P,mouseY:R},d*s,f.byteLength),s>0&&(await a,g=0),h%10===0){const o=performance.now()-r,e=t-b,n=e>0?1e3/e:0;T.innerText=`FPS: ${n.toFixed(1)}, Render: ${o.toFixed(2)}ms, Threads: ${s+1}, Res: ${c}x${i}px`,h=0}b=t,h++,I.set(f),Y.putImageData(D,0,0),requestAnimationFrame(E)}E();
