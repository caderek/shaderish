(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))o(e);new MutationObserver(e=>{for(const r of e)if(r.type==="childList")for(const i of r.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&o(i)}).observe(document,{childList:!0,subtree:!0});function c(e){const r={};return e.integrity&&(r.integrity=e.integrity),e.referrerPolicy&&(r.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?r.credentials="include":e.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(e){if(e.ep)return;e.ep=!0;const r=c(e);fetch(e.href,r)}})();function g(t,n=1){return t/n*2-1}function C(t,n,c,o,e,r){for(let i=e;i<r;i+=4){const h=i/4,A=h%n,E=Math.trunc(h/n),F=(A+.5)/(n/2)-1,j=1-(E+.5)/(n/2);t.set(c(F,j,o),i)}}const U=1/0,y=360*2/devicePixelRatio,s=360,$=s>y?1:y/s,q=await Promise.all(["plasma","singularity","accretion"].map(X)),L=q[0],f=document.querySelector("canvas",{alpha:!1,willReadFrequently:!1});f.width=s;f.height=s;f.style.setProperty("--size",s);f.style.setProperty("--scale",$);const B=document.getElementById("fps"),N=f.getContext("2d");async function X(t){const n=await fetch(`/shaders/${t}.js`).then(o=>o.blob()),c=new File([n],"shader.js",{type:"application/javascript"});return URL.createObjectURL(c)}const u=s**2*4,S=crossOriginIsolated?new SharedArrayBuffer(u):new ArrayBuffer(u),d=new Uint8ClampedArray(S),O=crossOriginIsolated?new Uint8ClampedArray(u):d,Y=new ImageData(O,s,s);let m=0,w=0,v=0,I=0;window.addEventListener("mousemove",t=>{v=g(t.clientX,1920),I=g(t.clientY,1080)});const K=navigator.hardwareConcurrency??4,a=Math.min(crossOriginIsolated?K-1:0,U),T=Math.ceil(d.byteLength/128),l=Math.ceil(T/(a+1))*128;console.log({crossOriginIsolated});console.log({threads:a+1});console.log({bufferSize:u,chunkSize:l});const P=Array.from({length:a},()=>new Worker(new URL("/assets/run-BjxK4YWS.js",import.meta.url),{type:"module"}));let p=0,b=0,x=null,M=null,W=new Promise(t=>{M=t});const D=(await import(L)).fragment;P.forEach(t=>{t.addEventListener("message",n=>{switch(n.data){case"rendered":{p++,p===a&&x();break}case"loaded":{b++,b===a&&M();break}}}),t.postMessage(["init",S,s]),t.postMessage(["loadShader",L])});async function R(t=0){a>0&&await W;const n=performance.now();let c;if(a>0&&(c=new Promise(o=>{x=o}),P.forEach((o,e)=>o.postMessage(["runShader",{t:t/1e3},[[e*l,e*l+l]]]))),C(d,s,D,{t:t/1e3,mouseX:v,mouseY:I},l*a,d.byteLength),a>0&&(await c,p=0),m%10===0){const o=performance.now()-n,e=t-w,r=e>0?1e3/e:0;B.innerText=`FPS: ${r.toFixed(1)}, Render: ${o.toFixed(2)}ms, Threads: ${a+1}, Res: ${s}px`,m=0}w=t,m++,O.set(d),N.putImageData(Y,0,0),requestAnimationFrame(R)}R();
