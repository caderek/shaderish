(function(){"use strict";function F(w,r,e,t,n,o,i){const l=n*o,s=r[3],h=r[4],b=new Uint32Array(w.buffer,0),k=new ArrayBuffer(16),y=new Float32Array(k,0,4),M=e[0],C=new Float32Array([e[1],e[2]]),v=new Float32Array([e[3],e[4]]);for(;;){const c=Atomics.add(r,0,1);if(c>=l)return;const z=c*i/4,B=z+i/4,U=c%n,X=Math.trunc(c/n);for(let A=z,m=0;A<B;A++,m++)y[0]=m%s+U*s+.5,y[1]=Math.trunc(m/s)+X*h+.5,b[A]=t(y,C,M,v)}}let d=null,p=null,a=null,S=null,f=0,u=0,g=0;onmessage=async w=>{const[r,...e]=w.data;switch(r){case"init":{const[t,n,o,i,l,s,h]=e;p=new Uint8ClampedArray(t,0,n),a=new Int32Array(t,n+l,o/4),S=new Float32Array(t,n+o+l*2,i/4),f=s,u=h,g=n/(f*u);break}case"loadShader":{const[t]=e;d=(await import(t)).fragment,self.postMessage("loaded");break}case"runShader":{if(!d)throw new Error("No shader provided");F(p,a,S,d,f,u,g),Atomics.add(a,1,1)===a[2]-1&&Atomics.notify(a,1);break}default:console.warn(`Message "${r}" is not handled.`)}}})();
