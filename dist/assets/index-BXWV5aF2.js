(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))r(t);new MutationObserver(t=>{for(const o of t)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function a(t){const o={};return t.integrity&&(o.integrity=t.integrity),t.referrerPolicy&&(o.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?o.credentials="include":t.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(t){if(t.ep)return;t.ep=!0;const o=a(t);fetch(t.href,o)}})();function b(e,n=1){return e/n*2-1}const f=8;function D(e,n,a,r,t){const{w:o,h:i}=a,L=Math.ceil(o/f);for(let h=r;h<t;h++){const P=h%L*f,M=Math.trunc(h/L)*f;for(let d=M;d<M+f&&d<i;d++){const B=d*o;for(let u=P;u<P+f&&u<o;u++){const y=(B+u)*4,T=Math.fround((u+.5)/(o/2)-1),Y=Math.fround(1-(d+.5)/(i/2)),g=n(T,Y,a);e[y]=g[0]*255,e[y+1]=g[1]*255,e[y+2]=g[2]*255,e[y+3]=g[3]*255}}}}document.querySelector("footer").textContent="v0.0.1";const W=1/0,_=640*2/devicePixelRatio,R=e=>e/1,c=R(640),l=R(360),z=_/c,K=await Promise.all(["plasma","singularity","rainbow","warp"].map(G)),E=K[3],m=document.querySelector("canvas",{alpha:!1,willReadFrequently:!1});m.width=c;m.height=l;m.style.setProperty("--width",c);m.style.setProperty("--scale",z);const Z=document.getElementById("fps"),k=m.getContext("2d");async function G(e){const n=await fetch(`/shaders/${e}.js`).then(r=>r.blob()),a=new File([n],"shader.js",{type:"application/javascript"});return URL.createObjectURL(a)}const w=c*l*4,A=crossOriginIsolated?new SharedArrayBuffer(w):new ArrayBuffer(w),S=new Uint8ClampedArray(A),C=crossOriginIsolated?new Uint8ClampedArray(w):S,H=new ImageData(C,c,l);let O=0,v=0,F=0,$=0;window.addEventListener("mousemove",e=>{F=b(e.clientX,1920),$=b(e.clientY,1080)});const J=navigator.hardwareConcurrency??4,s=Math.min(crossOriginIsolated?J-1:0,W),Q=8**2*4,j=Math.ceil(S.byteLength/Q),p=Math.ceil(j/(s+1));console.log({crossOriginIsolated});console.log({threads:s+1});console.log({bufferSize:w,tilesPerWorker:p});const U=Array.from({length:s},()=>new Worker(new URL("/assets/run-DoOoINmP.js",import.meta.url),{type:"module"}));let I=0,x=0,q=null,N=null,V=new Promise(e=>{N=e});const ee=(await import(E)).fragment;U.forEach(e=>{e.addEventListener("message",n=>{switch(n.data){case"rendered":{I++,I===s&&q();break}case"loaded":{x++,x===s&&N();break}}}),e.postMessage(["init",A]),e.postMessage(["loadShader",E])});async function X(e=0){s>0&&await V;const n=performance.now();let a;if(s>0&&(a=new Promise(r=>{q=r}),U.forEach((r,t)=>r.postMessage(["runShader",{t:e/1e3,w:c,h:l},[[t*p,t*p+p]]]))),D(S,ee,{t:e/1e3,w:c,h:l,mouseX:F,mouseY:$},p*s,j),s>0&&(await a,I=0),O%10===0){const r=performance.now()-n,t=e-v,o=t>0?1e3/t:0;Z.innerText=`FPS: ${o.toFixed(1)}, Render: ${r.toFixed(2)}ms, Threads: ${s+1}, Res: ${c}x${l}px`,O=0}v=e,O++,C.set(S),k.putImageData(H,0,0),requestAnimationFrame(X)}X();
