(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const n of o)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function s(o){const n={};return o.integrity&&(n.integrity=o.integrity),o.referrerPolicy&&(n.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?n.credentials="include":o.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(o){if(o.ep)return;o.ep=!0;const n=s(o);fetch(o.href,n)}})();const re=["solid","gradient","noise","circle","plasma","singularity","rainbow","liquid","warp","accretion","phosphor"];function se(e){document.querySelector("footer").innerHTML="<p>"+re.map(t=>`<a href="/?shader=${t}&res=${e.get("res")??"640x360"}&tile=${e.get("tile")??"8x8"}">${t}</a>`).join(" | ")+"</p><p>"+["1920x1080","1280x720","640x360","320x180","160x90"].map(t=>`<a href="/?shader=${e.get("shader")??"singularity"}&res=${t}&tile=${e.get("tile")??"8x8"}">${t}p</a>`).join(" | ")+"</p><p>"+["1x1","2x2","4x4","8x8","16x16","32x32","64x64","2x1","4x2","8x4","16x8","32x16","64x32"].map(t=>`<a href="/?shader=${e.get("shader")??"singularity"}&res=${e.get("res")??"640x360"}&tile=${t}">${t}</a>`).join(" | ")+"</p>"}function q(e,t=1){return e/t*2-1}function ae(e,t,s,r,o,n,a){const p=o*n,m=t[3],v=t[4],I=new Uint32Array(e.buffer,0),[T,$,A]=s;for(;;){const d=Atomics.add(t,0,1);if(d>=p)return;const h=d*a/4,F=h+a/4,b=d%o,R=Math.trunc(d/o);for(let f=h,U=0;f<F;f++,U++){const ee=U%m+b*m,te=Math.trunc(U/m)+R*v,oe=Math.fround((ee+.5)/($/2)-1),ne=Math.fround(1-(te+.5)/(A/2));I[f]=r(oe,ne,T,$,A)}}}function ie(e,t,s,r,o){const a=e.length/4,p=s*r,v=a/p/o,I=new Uint32Array(e.buffer,e.byteOffset,a),T=new Uint32Array(t.buffer,t.byteOffset,t.length/4),$=o*s;let A=0;for(let d=0;d<v;d++)for(let h=0;h<o;h++){const F=d*r*$+h*s;for(let b=0;b<r;b++){const R=F+b*$;for(let f=0;f<s;f++)T[R+f]=I[A++]}}}document.querySelector("footer").textContent="v0.0.1";const y={tileCounter:0,workersDone:1,workersCount:2,tileSizeX:3,tileSizeY:4},C=new URLSearchParams(location.search);se(C);const[i,l]=(C.get("res")??"640x360").split("x").map(Number),ce=C.get("shader")??"plasma",[x,w]=(C.get("tile")??"8x8").split("x").map(Number),W=await he(ce),le=1/0,de=Math.floor(window.innerWidth/320),fe=320*de,ue=fe/i,S=document.querySelector("canvas",{alpha:!1,willReadFrequently:!1});S.width=i;S.height=l;S.style.setProperty("--width",i);S.style.setProperty("--scale",ue);S.style.setProperty("--ratio",`${i} / ${l}`);const pe=document.getElementById("fps"),me=S.getContext("2d");async function he(e){const t=await fetch(`/shaders/${e}.js`).then(r=>r.blob()),s=new File([t],"shader.js",{type:"application/javascript"});return URL.createObjectURL(s)}const ye=i*l*4,K=x*w*4,M=Math.ceil(i/x),B=Math.ceil(l/w),O=M*B,u=K*O,L=0,P=64,j=64,X=u+L+P+L+j,E=crossOriginIsolated?new SharedArrayBuffer(X):new ArrayBuffer(X),Y=new Uint8ClampedArray(E,0,u),g=new Int32Array(E,u+L,P/4),z=new Float32Array(E,u+P+L*2,j/4),G=crossOriginIsolated?new Uint8ClampedArray(u):Y,ge=new ImageData(G.subarray(0,ye),i,l);let N=0,k=0,H=0,Z=0;window.addEventListener("mousemove",e=>{H=q(e.clientX,1920),Z=q(e.clientY,1080)});const xe=navigator.hardwareConcurrency??4,c=Math.min(crossOriginIsolated?xe:0,le),we=Math.ceil(O/c);console.log({crossOriginIsolated});console.log({threads:c>0?c:1});console.table({w:i,h:l,tileSizeX:x,tileSizeY:w,tilesPerRow:M,tilesPerCol:B,tilesCount:O,tileByteSize:K,tilesPerWorker:we,framebufferSize:u,controlbufferSize:P,vramSize:X});console.log(E);const J=Array.from({length:c},()=>new Worker(new URL("/assets/run-CKNG7NL_.js",import.meta.url),{type:"module"}));let _=0,D=0,Se=null,Q=null,$e=new Promise(e=>{Q=e});const be=(await import(W)).fragment;J.forEach(e=>{e.addEventListener("message",t=>{switch(t.data){case"rendered":{_++,_===c&&Se();break}case"loaded":{D++,D===c&&Q();break}}}),e.postMessage(["init",E,u,P,j,L,M,B]),e.postMessage(["loadShader",W])});g[y.workersCount]=c;g[y.tileSizeX]=x;g[y.tileSizeY]=w;async function V(e=0){c>0&&await $e;const t=performance.now();z[0]=e/1e3,z[1]=i,z[2]=l,c>0?(J.forEach((r,o)=>r.postMessage(["runShader"])),await Atomics.waitAsync(g,y.workersDone,0).value,_=0,g[y.tileCounter]=0,g[y.workersDone]=0):ae(Y,be,{t:e/1e3,w:i,h:l,mouseX:H,mouseY:Z},0,O);const s=performance.now();if(ie(Y,G,x,w,M),me.putImageData(ge,0,0),N%10===0){const r=performance.now(),o=s-t,n=r-s,a=o+n,p=e-k,m=p>0?1e3/p:0;pe.innerText=`FPS: ${m.toFixed(1)}, All: ${a.toFixed(2).padStart(5,"0")}ms, Shader: ${o.toFixed(2).padStart(5,"0")}ms, Clone: ${n.toFixed(2).padStart(5,"0")}ms, Threads: ${c??1}, Res: ${i}x${l}px, Tile: ${x}x${w}`,N=0}k=e,N++,requestAnimationFrame(V)}V();
